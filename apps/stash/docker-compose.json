{
  "services": [
    {
      "name": "stash",
      "image": "nerethos/stash:latest",
      "environment": {
        "PUID": "1000",
        "PGID": "1000",
        "STASH_STASH": "/data/",
        "STASH_GENERATED": "/generated/",
        "STASH_METADATA": "/metadata/",
        "STASH_CACHE": "/cache/",
        "STASH_PORT": "9999",
        "NVIDIA_VISIBLE_DEVICES": "all",
        "NVIDIA_DRIVER_CAPABILITIES": "all"
      },
      "isMain": true,
      "internalPort": 9999,
      "deploy": {
        "resources": {
          "reservations": {
            "devices": [
              {
                "driver": "nvidia",
                "count": "all",
                "capabilities": [
                  "gpu"
                ]
              }
            ]
          }
        }
      },
      "volumes": [
        {
          "hostPath": "/etc/localtime",
          "containerPath": "/etc/localtime",
          "readOnly": true
        },
        {
          "hostPath": "${APP_DATA_DIR}/data/config",
          "containerPath": "/root/.stash",
          "readOnly": false
        },
        {
          "hostPath": "${APP_DATA_DIR}/data/data",
          "containerPath": "/data",
          "readOnly": false
        },
        {
          "hostPath": "${APP_DATA_DIR}/data/metadata",
          "containerPath": "/metadata",
          "readOnly": false
        },
        {
          "hostPath": "${APP_DATA_DIR}/data/cache",
          "containerPath": "/cache",
          "readOnly": false
        },
        {
          "hostPath": "${APP_DATA_DIR}/data/blobs",
          "containerPath": "/blobs",
          "readOnly": false
        },
        {
          "hostPath": "${APP_DATA_DIR}/data/generated",
          "containerPath": "/generated",
          "readOnly": false
        }
      ],
      "restart": "unless-stopped",
      "logging": {
        "driver": "json-file",
        "options": {
          "max-file": "10",
          "max-size": "2m"
        }
      }
    }
  ]
}
